name: Temp Public Server

on: workflow_dispatch

jobs:
  public-access:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
      
    - name: Install serve
      run: npm install -g serve
      
    - name: Start multiple servers
      run: |
        # –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ 3002
        start /B cmd /c "node setup.js"
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        echo "<html><body><h1>Yandex Music Server</h1><p>HTTP: <a href='http://localhost:3002'>localhost:3002</a></p><p>WebSocket: ws://localhost:3002</p></body></html>" > status.html
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ 8080
        serve -p 8080 . &
        
        echo "üìä –°—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://localhost:8080/status.html"
        
    - name: Expose with localtunnel
      run: |
        npm install -g localtunnel
        # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å –¥–ª—è –ø–æ—Ä—Ç–∞ 3002
        npx lt --port 3002 --subdomain yandex-music-$(date +%s) &
        # –ò –¥–ª—è –ø–æ—Ä—Ç–∞ 8080
        npx lt --port 8080 &
        
        # –ñ–¥–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏
        timeout /t 15
        echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫–∏ –≤—ã—à–µ –≤ –ª–æ–≥–∞—Ö lt"
